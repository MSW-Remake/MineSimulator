# 기능별 가이드 - 플레이어 관리 - 장비 시스템

## 개요
장비 시스템은 플레이어가 무기, 방어구, 악세서리 등을 착용하여 능력치를 향상시키는 핵심 시스템입니다. 각 장비는 고유한 능력치와 특수 효과를 가지고 있으며, 플레이어의 전투력과 생존력에 직접적인 영향을 미칩니다.

## 장비 타입

### 무기 (Weapon)
- **곡괭이**: 채굴 효율성 향상
- **검**: 전투 공격력 증가
- **지팡이**: 마법 능력 향상
- **활**: 원거리 공격 능력

### 방어구 (Armor)
- **헬멧**: 머리 보호, 방어력 증가
- **상의**: 몸통 보호, 체력 증가  
- **하의**: 다리 보호, 이동속도 향상
- **장갑**: 손 보호, 채굴 속도 증가

### 악세서리 (Accessory)
- **목걸이**: 특수 능력 부여
- **반지**: 능력치 보너스
- **귀걸이**: 경험치 획득량 증가

### 기타 장비
- **가방**: 인벤토리 슬롯 확장
- **신발**: 이동속도 및 점프력 향상

## 관련 파일 경로

### 장비 시스템 스크립트
```
RootDesk/MyDesk/Components/Player/Equipment/
├── EquipmentUI.mlua                        # 장비 창 UI 관리
├── EquipmentUI.codeblock                   # 장비 UI 비주얼 스크립팅
├── EquipmentUISlotButton.mlua              # 장비 슬롯 버튼 처리
├── EquipmentUISlotButton.codeblock         # 장비 슬롯 비주얼
├── PlayerEquipmentManager.mlua             # 플레이어 장비 상태 관리
└── PlayerEquipmentManager.codeblock        # 장비 매니저 비주얼
```

### 장비 이미지 리소스
```
RootDesk/MyDesk/Images/장비/
├── 무기/                                   # 무기 스프라이트들
│   ├── 곡괭이_1티어.sprite
│   ├── 곡괭이_2티어.sprite
│   └── ... (40개 무기 스프라이트)
├── 옷/                                     # 방어구 스프라이트들  
│   ├── 상의_1티어.sprite
│   ├── 상의_2티어.sprite
│   └── ... (40개 방어구 스프라이트)
├── 신발/                                   # 신발 스프라이트들
│   └── ... (40개 신발 스프라이트)
└── 가방/                                   # 가방 스프라이트들
    └── ... (40개 가방 스프라이트)
```

### 장비 데이터 파일
```
RootDesk/MyDesk/DataSets/
├── EquipmentData.csv                       # 장비 기본 정보
├── EquipmentData.userdataset              # 장비 데이터셋
├── WeaponData.csv                         # 무기별 상세 데이터
├── ArmorData.csv                          # 방어구별 상세 데이터
└── AccessoryData.csv                      # 악세서리별 상세 데이터
```

### UI 그룹 파일
- `ui/EquipmentStorageGroup.ui`: 장비 저장고 UI 그룹

## 장비 시스템 구현 세부사항

### 장비 착용/해제 로직
```lua
-- EquipmentUI.mlua에서 구현되는 핵심 로직

method void EquipItem(string itemId)
    -- 1. 현재 착용 중인 장비 확인
    local currentEquip = self:GetEquippedItem(slot)
    
    -- 2. 현재 장비가 있으면 인벤토리로 이동
    if currentEquip then
        InventoryManager:AddItem(currentEquip)
    end
    
    -- 3. 새 장비 착용
    self:SetEquippedItem(slot, itemId)
    
    -- 4. 능력치 재계산
    self:RecalculateStats()
    
    -- 5. UI 업데이트
    self:UpdateEquipmentUI()
end
```

### 능력치 계산
```lua
-- PlayerEquipmentManager.mlua의 능력치 계산

method table CalculateTotalStats()
    local totalStats = {}
    
    -- 각 장비 슬롯 순회
    for slotType, equipment in pairs(self.equippedItems) do
        local equipStats = EquipmentData:GetStats(equipment.id)
        
        -- 능력치 합산
        for statName, value in pairs(equipStats) do
            totalStats[statName] = (totalStats[statName] or 0) + value
        end
    end
    
    return totalStats
end
```

### 장비 강화 시스템
```lua
-- 장비 강화 레벨에 따른 능력치 증가

method number GetEnhancedStatValue(number baseValue, number enhanceLevel)
    local multiplier = 1 + (enhanceLevel * 0.1) -- 레벨당 10% 증가
    return math.floor(baseValue * multiplier)
end
```

## 장비 등급 시스템

### 등급별 특성
1. **일반 (Common)**: 흰색, 기본 능력치
2. **고급 (Uncommon)**: 초록색, 능력치 +20%
3. **희귀 (Rare)**: 파란색, 능력치 +50%, 특수 옵션 1개
4. **영웅 (Epic)**: 보라색, 능력치 +100%, 특수 옵션 2개  
5. **전설 (Legendary)**: 주황색, 능력치 +200%, 특수 옵션 3개

### 등급별 색상 처리
```
RootDesk/MyDesk/Material/GradeColor/
├── grade_common.material                   # 일반 등급 색상
├── grade_uncommon.material                 # 고급 등급 색상
├── grade_rare.material                     # 희귀 등급 색상
└── grade_legendary.material                # 전설 등급 색상
```

## 장비 획득 방법

### 상점 구매
- 장비 상점에서 골드로 구매
- 젬 상점에서 프리미엄 화폐로 구매

### 드롭 획득  
- 광산 탐험 중 몬스터 처치 시 드롭
- 보물상자에서 획득
- 특별 이벤트 보상

### 제작 시스템
- 재료 아이템을 조합하여 제작
- 제작 시 랜덤 옵션 부여

## 저장 및 동기화

### 장비 데이터 저장 구조
```lua
PlayerEquipmentData = {
    equipped = {
        weapon = { id = "sword_001", enhanceLevel = 5 },
        armor = { id = "plate_001", enhanceLevel = 3 },
        accessory = { id = "ring_001", enhanceLevel = 1 }
    },
    storage = {
        -- 보관 중인 장비 리스트
    }
}
```

### TableSync를 통한 동기화
- `TableSync.mlua`를 통해 장비 상태를 서버와 동기화
- 실시간 장비 변경 사항 반영

## 확장 방법

### 새로운 장비 타입 추가
1. `EquipmentData.csv`에 새 장비 정보 추가
2. 해당 장비의 스프라이트 추가
3. `EquipmentUI.mlua`에 새 슬롯 처리 로직 추가
4. UI에 새 슬롯 추가

### 장비 세트 시스템 추가
1. 세트 장비 데이터 정의
2. 세트 효과 계산 로직 구현
3. UI에 세트 효과 표시 기능 추가