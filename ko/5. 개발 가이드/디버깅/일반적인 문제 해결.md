# 개발 가이드 - 디버깅 - 일반적인 문제 해결

## 개요
광부 시뮬레이터 개발 중 자주 발생하는 문제들과 해결 방법에 대한 가이드입니다.

## 스크립트 관련 문제

### 1. 컴포넌트가 작동하지 않는 경우

**문제**: 스크립트를 작성했지만 동작하지 않음
**해결 방법**:
```lua
-- OnBeginPlay가 호출되는지 확인
method void OnBeginPlay()
    log("OnBeginPlay 호출됨")  -- 로그로 확인
    
    -- 서버/클라이언트 확인
    if self:IsServer() then
        log("서버에서 실행")
    elseif self:IsClient() then  
        log("클라이언트에서 실행")
    end
end
```

**체크리스트**:
- [ ] 컴포넌트가 엔티티에 제대로 붙어있는지 확인
- [ ] @Component 어노테이션이 있는지 확인  
- [ ] 상속 관계가 올바른지 확인 (extends Component)
- [ ] ExecSpace가 올바르게 설정되었는지 확인

### 2. 동기화 문제

**문제**: 서버와 클라이언트 간 데이터가 동기화되지 않음
**해결 방법**:
```lua
-- @Sync 프로퍼티 확인
@Sync  
property number syncedValue = 0

-- SetTableClient로 수동 동기화
@ExecSpace("Server")
method void UpdateClientData()
    self:SetTableClient("playerData", 
        _UtilLogic:TableToString(self.playerData), 
        self.Entity.OwnerId)
end

-- OnSyncProperty로 동기화 확인
@ExecSpace("Client")
method void OnSyncProperty(string name, any value)
    log("동기화됨: " .. name .. " = " .. tostring(value))
end
```

## UI 관련 문제

### 1. UI가 표시되지 않는 경우

**체크리스트**:
- [ ] UI 그룹이 활성화되어 있는지 확인
- [ ] 경로가 올바른지 확인
- [ ] Enable 상태 확인
- [ ] 소팅 레이어 확인

```lua
-- UI 상태 디버깅
method void DebugUI()
    local ui = _EntityService:GetEntityByPath("/ui/MenuGroup/Button")
    
    if ui then
        log("UI 찾음: " .. ui.Path)
        log("Enable 상태: " .. tostring(ui.Enable))
        log("소팅 레이어: " .. tostring(ui.SortingLayer))
    else
        log("UI를 찾을 수 없음")
    end
end
```

### 2. 버튼 클릭이 작동하지 않는 경우

```lua
-- 버튼 이벤트 바인딩 확인
method void SetupButton()
    local button = _EntityService:GetEntityByPath("/ui/MenuGroup/Button")
    
    if button and button.ButtonComponent then
        button.ButtonComponent.OnClick:Connect(function()
            log("버튼 클릭됨")
        end)
    else
        log("ButtonComponent를 찾을 수 없음")
    end
end
```

## 데이터 관련 문제

### 1. DataService 접근 실패

```lua
-- 데이터 테이블 디버깅
method void DebugDataTable(string tableName)
    local table = _DataService:GetTable(tableName)
    
    if table then
        log("테이블 " .. tableName .. " 로드됨")
        log("행 수: " .. tostring(table:GetRowCount()))
        
        -- 첫 번째 행 출력
        if table:GetRowCount() > 0 then
            local firstRow = table:GetRow(1)
            log("첫 번째 행: " .. tostring(firstRow))
        end
    else
        log("테이블 " .. tableName .. "을 찾을 수 없음")
    end
end
```

## 이벤트 관련 문제

### 1. 이벤트가 발생하지 않는 경우

```lua
-- 이벤트 핸들러 디버깅
@EventSender("Self")
handler HandleTriggerEnterEvent(TriggerEnterEvent event)
    log("TriggerEnterEvent 발생")
    log("트리거한 엔티티: " .. tostring(event.TriggerBodyEntity.Name))
    
    -- 엔티티 태그 확인
    if event.TriggerBodyEntity.TagComponent then
        log("태그: " .. tostring(event.TriggerBodyEntity.TagComponent.Tags[1]))
    end
end
```

**체크리스트**:
- [ ] 트리거 콜라이더가 설정되어 있는지 확인
- [ ] 적절한 레이어에 있는지 확인
- [ ] 이벤트 핸들러 어노테이션이 올바른지 확인

## 로그 사용법

### 효과적인 로깅
```lua
-- 기본 로그
log("기본 메시지")

-- 변수값 포함
log("플레이어 HP: " .. tostring(player.health))

-- 조건부 로그
if DEBUG_MODE then
    log("디버그: " .. debugInfo)
end

-- 에러 로그
if not success then
    log("ERROR: 작업 실패 - " .. errorMessage)
end
```

### 로그 카테고리화
```lua
-- 카테고리별 로그 함수
method void LogInfo(string message)
    log("[INFO] " .. message)
end

method void LogError(string message)
    log("[ERROR] " .. message)
end

method void LogDebug(string message)
    if self.debugMode then
        log("[DEBUG] " .. message)
    end
end
```

## 성능 문제 해결

### 1. 프레임 드롭 문제

**원인과 해결책**:
- **과도한 Update 호출**: 필요할 때만 업데이트
- **불필요한 UI 갱신**: 변화가 있을 때만 갱신
- **메모리 누수**: 사용하지 않는 오브젝트 정리

```lua
-- 최적화된 업데이트
property boolean needsUpdate = false
property number lastUpdateTime = 0

method void OnUpdate(number deltaTime)
    local currentTime = _TimeService:GetTime()
    
    -- 0.1초마다만 업데이트
    if self.needsUpdate and (currentTime - self.lastUpdateTime) > 0.1 then
        self:UpdateLogic()
        self.needsUpdate = false  
        self.lastUpdateTime = currentTime
    end
end

method void RequestUpdate()
    self.needsUpdate = true
end
```

### 2. 메모리 관리

```lua
-- 오브젝트 풀링
local objectPool = {}

method Entity GetPooledObject(string objectType)
    if objectPool[objectType] == nil then
        objectPool[objectType] = {}
    end
    
    local pool = objectPool[objectType]
    if #pool > 0 then
        return table.remove(pool)
    else
        return self:CreateNewObject(objectType)
    end
end

method void ReturnToPool(Entity obj, string objectType)
    obj.Enable = false
    table.insert(objectPool[objectType], obj)
end
```

## 일반적인 에러 메시지와 해결법

### "nil 값에 접근" 에러
```lua
-- 안전한 접근 방법
if entity and entity.Component then
    entity.Component:DoSomething()
else
    log("Entity 또는 Component가 nil입니다")
end

-- isvalid 사용
if isvalid(entity) then
    entity:DoSomething()
end
```

### "경로를 찾을 수 없음" 에러
```lua
-- 경로 존재 여부 확인
local ui = _EntityService:GetEntityByPath("/ui/MenuGroup")
if ui then
    log("경로 존재함")
else
    log("경로가 존재하지 않음: /ui/MenuGroup")
end
```

### 타입 변환 에러  
```lua
-- 안전한 타입 변환
local numValue = tonumber(stringValue)
if numValue then
    -- 변환 성공
    self.value = numValue
else
    log("숫자 변환 실패: " .. tostring(stringValue))
    self.value = 0  -- 기본값 설정
end
```

## 디버깅 도구 활용

### 1. 게임 내 디버그 UI
```lua
-- 디버그 정보 표시 UI
method void ShowDebugInfo()
    local debugUI = _EntityService:GetEntityByPath("/ui/DebugInfo")
    if debugUI then
        debugUI:GetChildByName("PlayerHP").TextComponent.Text = "HP: " .. tostring(self.health)
        debugUI:GetChildByName("PlayerMP").TextComponent.Text = "MP: " .. tostring(self.mana)
        debugUI:GetChildByName("Position").TextComponent.Text = "Pos: " .. tostring(self.Entity.Transform.Position)
    end
end
```

### 2. 조건부 디버깅
```lua
-- 디버그 모드 설정
property boolean isDebugMode = false

method void DebugLog(string message)
    if self.isDebugMode then
        log("[DEBUG] " .. message)
        
        -- 게임 내 디버그 UI에도 표시
        self:ShowDebugMessage(message)
    end
end
```