# 개발 가이드 - 컴포넌트 구조 - 스크립트 작성 방법

## 개요
이 문서는 광부 시뮬레이터 프로젝트에서 mlua 스크립트를 작성하는 방법과 컴포넌트 구조에 대한 가이드입니다. mlua는 MOD 엔진의 스크립팅 언어로, Lua를 기반으로 한 게임 개발 전용 언어입니다.

## mlua 기본 구조

### 컴포넌트 선언
```lua
@Component
script ComponentName extends BaseComponent

    -- 프로퍼티 선언
    property type propertyName = defaultValue
    
    -- 동기화 프로퍼티
    @Sync
    property type syncPropertyName = defaultValue
    
    -- 메서드 선언
    method void MethodName(parameters)
        -- 메서드 내용
    end
    
    -- 이벤트 핸들러
    @EventSender("Target")
    handler HandleEventName(EventType event)
        -- 이벤트 처리 로직
    end
```

### 실행 공간 지정
```lua
-- 서버에서만 실행
@ExecSpace("Server")
method void ServerOnlyMethod()
    -- 서버 로직
end

-- 클라이언트에서만 실행
@ExecSpace("Client")
method void ClientOnlyMethod()
    -- 클라이언트 로직
end

-- 서버와 클라이언트 모두에서 실행
@ExecSpace("ServerAndClient")
method void SharedMethod()
    -- 공통 로직
end
```

## 베스트 프랙티스

### 1. 네이밍 규칙
- **컴포넌트**: PascalCase (예: PlayerData, InventoryUI)
- **메서드**: PascalCase (예: AddItem, RefreshUI)
- **프로퍼티**: camelCase (예: maxHealth, isActive)
- **이벤트 핸들러**: Handle + EventName + Event (예: HandleButtonClickEvent)

### 2. 코드 구조
```lua
@Component
script ExampleComponent extends Component

    -- 상수 선언
    local MAX_ITEMS = 180
    local DEFAULT_HEALTH = 100
    
    -- 프로퍼티 그룹별 정리
    -- 기본 프로퍼티
    property number health = DEFAULT_HEALTH
    property boolean isActive = true
    
    -- 동기화 프로퍼티
    @Sync
    property number playerId = 0
    @Sync
    property string playerName = ""
    
    -- 테이블 프로퍼티
    property SyncTable<number> itemList
    property SyncTable<boolean> flagList
    
    -- 생명주기 메서드
    method void OnBeginPlay()
        if self:IsServer() then
            self:InitializeServer()
        elseif self:IsClient() then
            self:InitializeClient()
        end
    end
    
    -- 서버 메서드
    @ExecSpace("Server")
    method void InitializeServer()
        log("서버 초기화")
    end
    
    -- 클라이언트 메서드
    @ExecSpace("Client")
    method void InitializeClient()
        log("클라이언트 초기화")
    end
    
    -- 이벤트 핸들러들
    @EventSender("Self")
    handler HandleTriggerEnterEvent(TriggerEnterEvent event)
        -- 이벤트 처리
    end
```

### 3. 데이터 관리
```lua
-- DataService 사용
local itemTable = _DataService:GetTable("ItemData")
local itemName = itemTable:GetCell(1, "Name")
local itemRow = itemTable:GetRow(1)

-- SyncTable 사용
property SyncTable<number> playerStats

method void InitializeStats()
    for i=1, 10 do
        self.playerStats[i] = 0
    end
end

-- 클라이언트 동기화
@ExecSpace("Server")
method void UpdateClientData()
    self:SetTableClient("playerStats", 
        _UtilLogic:TableToString(self.playerStats), 
        self.Entity.OwnerId)
end
```

### 4. UI 상호작용
```lua
-- UI 엔티티 접근
local buttonUI = _EntityService:GetEntityByPath("/ui/MenuGroup/Button")
buttonUI.ButtonComponent.OnClick:Connect(function()
    self:OnButtonClicked()
end)

-- UI 새로고침
method void RefreshUI()
    local healthBar = _EntityService:GetEntityByPath("/ui/HealthBar/Fill")
    healthBar.UITransformComponent.RectSize = 
        Vector2(200 * (self.health / 100), healthBar.UITransformComponent.RectSize.y)
end
```

### 5. 타이머 사용
```lua
-- 일회성 타이머
_TimerService:SetTimerOnce(function()
    log("3초 후 실행")
end, 3.0)

-- 반복 타이머
local repeatTimer = function()
    log("매초 실행")
    _TimerService:SetTimerOnce(repeatTimer, 1.0)
end
repeatTimer()
```